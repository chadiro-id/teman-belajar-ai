<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="dicoding:email" content="chadiro.dev@gmail.com">
  <title>Teman Belajar AI</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
  <div id="app-container" class="app-container">
    <main id="chat-app" class="chat-app">
      <header class="chat-app__header">
        <div class="app-brand">
          <h1 class="app-brand__name">Teman Belajar</h1>
        </div>
        <div class="app-menu">
          <select id="subject" aria-label="Pilih mata pelajaran"></select>
        </div>
      </header>
      <div class="chat-app__content">
        <div id="chat-welcome" class="chat-welcome chat-welcome--hidden">
          <p class="chat-greeting">Halo, ingin belajar apa hari ini?</p>
        </div>
        <div id="chat-container" class="chat-container"></div>
      </div>
      <footer class="chat-app__footer">
        <div class="chat-input">
          <input type="text" id="chat-input__message" placeholder="Ketik pesan Anda...">
          <button type="button" id="chat-input__send-button">Kirim</button>
        </div>
        <p class="chat-info">Model AI bisa membuat kesalahan, selalu periksa kembali</p>
      </footer>
    </main>
    
    <div id="sidenav-control" class="sidenav-control">
      <button type="button" id="btn-toggle-sidenav" class="tb-button btn-toggle-sidenav" aria-label="Toggle sidenav">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
      </button>
    </div>
    <nav id="sidenav" class="sidenav sidenav--expanded">
      <header class="sidenav__header">
        <div class="sidenav__header-inner">
          <button type="button" id="btn-toggle-sidenav-expanded" class="tb-button btn-toggle-sidenav-expanded" aria-label="Toggle sidenav full width">
            <svg xmlns="http://www.w3.org/2000/svg" class="tb-button__icon" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
            </svg>
          </button>
          <button type="button" id="btn-toggle-theme"class="tb-button btn-toggle-theme"  title="Toggles light & dark" aria-label="auto" aria-live="polite">
            <svg class="ic-toggle-theme" aria-hidden="true" width="24" height="24" viewBox="0 0 24 24">
              <mask class="moon" id="moon-mask">
                <rect x="0" y="0" width="100%" height="100%" fill="white" />
                <circle cx="24" cy="10" r="6" fill="black" />
              </mask>
              <circle class="sun" cx="12" cy="12" r="6" mask="url(#moon-mask)" fill="currentColor" />
              <g class="sun-beams" stroke="currentColor">
                <line x1="12" y1="1" x2="12" y2="3" />
                <line x1="12" y1="21" x2="12" y2="23" />
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                <line x1="1" y1="12" x2="3" y2="12" />
                <line x1="21" y1="12" x2="23" y2="12" />
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
              </g>
            </svg>
          </button>
        </div>
      </header>
      <div class="sidenav__content">
        <div class="sidenav__content-inner">
          <button type="button" id="new-chat-btn" class="tb-button btn-new-chat">
            <svg xmlns="http://www.w3.org/2000/svg" class="tb-button__icon" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z" />
            </svg>
            <span class="tb-button__label sr-only">+ Buat Percakapan Baru</span>
          </button>
          <section id="conversations" class="conversations-container">
            <h2 class="conversations-heading">Baru baru ini</h2>
            <ul id="conversations-list" class="conversations-list"></ul>
          </section>
        </div>
      </div>
      <footer class="sidenav__footer">
        <div class="sidenav__footer-inner">
          <div id="current-user" class="current-user">
            <div class="current-user__avatar"></div>
            <span class="current-user__label">Loading...</span>
          </div>
        </div>
      </footer>
    </nav>
  </div>

  <div id="app-overlay" class="app-overlay">
    <div id="link-account-modal" class="modal modal--hidden">
      <div class="modal__overlay"></div>
      <div class="modal__content-container">
        <div class="modal__content">
          <h3>Gabungkan Akun?</h3>
          <p>Anda saat ini menggunakan akun tamu. Apakah Anda ingin menghubungkan riwayat percakapan Anda ke akun Google ini?</p>
          <div class="modal__actions">
            <button id="modal-link-account">Gabungkan</button>
            <button id="modal-start-new">Mulai Baru</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithPopup, GoogleAuthProvider, signOut, linkWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, doc, addDoc, getDoc, updateDoc, deleteDoc, query, where, orderBy, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Konfigurasi Firebase Anda (Ganti dengan kunci API Anda yang sebenarnya!)
    const firebaseConfig = {
      apiKey: "AIzaSyAp50SILueBPUAZjkhDZi_WwWyoodW2Q-k",
      authDomain: "temanbelajarai-1eaa5.firebaseapp.com",
      projectId: "temanbelajarai-1eaa5",
      storageBucket: "temanbelajarai-1eaa5.firebasestorage.com",
      messagingSenderId: "249646886614",
      appId: "1:249646886614:web:cd3364a6f3aa7d2b2ce377"
    };

    // Inisialisasi Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const googleProvider = new GoogleAuthProvider();

    // Export Firebase instances agar bisa diakses di main.js
    window.firebaseApp = app;
    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.googleAuthProvider = googleProvider;
    window.firebaseServerTimestamp = serverTimestamp; // Untuk timestamp server
    window.firebaseGetDoc = getDoc;
    window.firebaseDoc = doc;
    window.firebaseUpdateDoc = updateDoc;
    window.firebaseDeleteDoc = deleteDoc;
    window.firebaseQuery = query;
    window.firebaseWhere = where;
    window.firebaseOrderBy = orderBy;
    window.firebaseGetDocs = getDocs;
    window.firebaseCollection = collection;
    window.firebaseAddDoc = addDoc;
    window.firebaseSignInAnonymously = signInAnonymously;
    window.firebaseOnAuthStateChanged = onAuthStateChanged;
    window.firebaseSignInWithPopup = signInWithPopup;
    window.firebaseSignOut = signOut;
    window.firebaseLinkWithPopup = linkWithPopup;

  </script>
  <script type="module">
    import { marked } from "https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js";
    window.marked = marked;
  </script>
  <script type="module" src="./js/main.js"></script>
</body>
</html>